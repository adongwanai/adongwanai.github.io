---
import { type CollectionEntry, getCollection } from 'astro:content';
import Layout from '../../layouts/Layout.astro';

export async function getStaticPaths() {
	const posts = await getCollection('posts');
	return posts.map((post) => ({
		params: { slug: post.slug },
		props: post,
	}));
}

type Props = CollectionEntry<'posts'>;

const post = Astro.props;
const { Content } = await post.render();
---

<Layout title={post.data.title} description={post.data.description}>
	<article class="py-24 max-w-3xl mx-auto px-6">
		<div class="mb-12 text-center">
			
			<div class="mb-6 flex gap-2 justify-center">
				{post.data.tags.map(tag => (
					<span class="px-3 py-1 bg-white/5 border border-white/10 rounded-full text-xs text-blue-400">
						#{tag}
					</span>
				))}
			</div>

			<h1 class="text-4xl md:text-5xl font-bold mb-6 leading-tight">{post.data.title}</h1>
			
			<div class="text-gray-400 text-sm mb-8 flex items-center justify-center gap-4">
				<time datetime={post.data.pubDate.toISOString()}>
					{post.data.pubDate.toLocaleDateString('zh-CN', {
						year: 'numeric',
						month: 'long',
						day: 'numeric',
					})}
				</time>
				{post.data.updatedDate && (
					<div class="italic">
						(Updated on <time datetime={post.data.updatedDate.toISOString()}>
							{post.data.updatedDate.toLocaleDateString('zh-CN', {
								year: 'numeric',
								month: 'long',
								day: 'numeric',
							})}
						</time>)
					</div>
				)}
			</div>

			{post.data.heroImage && (
				<img 
					src={post.data.heroImage} 
					alt="" 
					class="w-full rounded-2xl border border-white/10 shadow-2xl mb-12"
				/>
			)}
			
			<p class="text-xl text-gray-300 leading-relaxed max-w-2xl mx-auto border-l-4 border-blue-500 pl-6 italic">
				{post.data.description}
			</p>
		</div>

		<div class="prose prose-invert prose-lg max-w-none prose-headings:font-bold prose-headings:text-white prose-a:text-blue-400 prose-code:text-blue-300 prose-pre:bg-secondary prose-pre:border prose-pre:border-white/10">
			<Content />
		</div>
	</article>
</Layout>
