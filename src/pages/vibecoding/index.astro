---
import Layout from '../../layouts/Layout.astro';
import { getCollection } from 'astro:content';

const allNotes = (await getCollection('vibecoding')).sort(
  (a, b) => a.data.order - b.data.order
);

// Group notes by directory for the sidebar
const groupedNotes = allNotes.reduce((acc, currentNote) => {
  const parts = currentNote.slug.split('/');
  const folder = parts.length > 1 ? parts.slice(0, -1).join('/') : 'Overview';
  
  if (!acc[folder]) acc[folder] = [];
  acc[folder].push(currentNote);
  return acc;
}, {} as Record<string, typeof allNotes>);

---

<Layout title="é˜¿ä¸œçš„ VibeCoding èµšé’±ç¬”è®°">
  <div class="pt-[90px] pb-24 px-4 sm:px-6 lg:px-8 max-w-[1440px] mx-auto flex flex-col md:flex-row gap-8">
    
    <!-- Left Sidebar (Menu) -->
    <aside class="hidden md:block w-64 lg:w-72 shrink-0">
      <div class="sticky top-[90px] h-[calc(100vh-[90px])] overflow-y-auto pr-4 pb-12 custom-scrollbar border-r border-gray-200 dark:border-white/10">
        <div class="mb-6">
           <a href="/vibecoding" class="text-sm font-bold text-blue-600 dark:text-blue-400 flex items-center gap-2 transition-colors">
             ğŸ“š èµšé’±ç¬”è®°é¦–é¡µ
           </a>
        </div>
        
        <div class="flex flex-col gap-6">
          {Object.entries(groupedNotes).map(([folder, folderNotes]) => (
            <div class="flex flex-col gap-2">
               {folder !== 'Overview' && (
                 <h3 class="font-bold text-gray-900 dark:text-gray-100 text-sm mb-1">{folder}</h3>
               )}
               <nav class="flex flex-col gap-[2px] border-l border-gray-200 dark:border-white/10 ml-2 pl-3">
                {folderNotes.map((item) => (
                  <a 
                    href={`/vibecoding/${item.slug}`} 
                    class="block py-1.5 px-3 rounded-md text-sm transition-all duration-200 text-gray-600 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-white/5 hover:text-gray-900 dark:hover:text-white"
                  >
                    {item.data.title}
                  </a>
                ))}
               </nav>
            </div>
          ))}
        </div>
      </div>
    </aside>

    <!-- Main Content Area -->
    <main class="flex-1 min-w-0 lg:px-8 mt-4 md:mt-0">
      <div class="mb-12">
        <div class="inline-flex items-center gap-2 px-3 py-1 bg-gray-100 dark:bg-white/5 border border-gray-200 dark:border-white/10 rounded-full text-xs text-accent mb-6 font-semibold uppercase tracking-wider">
          <span>ğŸ“š</span>
          <span>Documentation Series</span>
        </div>
        <h1 class="text-4xl md:text-5xl font-extrabold mb-6 text-gray-900 dark:text-white tracking-tight">é˜¿ä¸œçš„ VibeCoding èµšé’±ç¬”è®°</h1>
        <p class="text-gray-500 dark:text-gray-400 text-lg max-w-2xl leading-relaxed">
          è¿™æ˜¯ä¸€ä¸ªæŒç»­æ›´æ–°çš„å®æˆ˜æ–‡æ¡£åº“ã€‚åœ¨è¿™é‡Œæˆ‘ä¼šæ¯«æ— ä¿ç•™åœ°åˆ†äº« <span class="text-gray-800 dark:text-gray-200 font-medium">Vibe Coding æœ€ä½³å®è·µã€Agent å¼€å‘æŠ€å·§ä»¥åŠå¤§æ¨¡å‹å˜ç°æ€è·¯</span>ã€‚è¯·é€šè¿‡å·¦ä¾§å¯¼èˆªæ æˆ–ä¸‹æ–¹å¡ç‰‡å¼€å¯é˜…è¯»ã€‚
        </p>
      </div>

      <div class="grid grid-cols-1 xl:grid-cols-2 gap-6">
        {allNotes.map((note) => (
          <a href={`/vibecoding/${note.slug}`} class="group block">
            <div class="bg-white dark:bg-[#1a1c23] border border-gray-200 dark:border-white/10 rounded-xl p-6 h-full hover:border-accent/50 dark:hover:border-accent/40 hover:shadow-[0_4px_20px_-4px_rgba(56,189,248,0.1)] transition-all duration-300 relative overflow-hidden flex flex-col justify-between">
               <div class="absolute inset-0 bg-gradient-to-br from-blue-500/5 to-violet-500/5 opacity-0 group-hover:opacity-100 transition-opacity"></div>
               <div>
                 <h3 class="text-lg font-bold mb-3 text-gray-900 dark:text-gray-100 group-hover:text-accent dark:group-hover:text-blue-400 relative z-10 flex justify-between items-center transition-colors">
                   {note.data.title}
                 </h3>
                 <p class="text-gray-500 dark:text-gray-400 text-sm leading-relaxed relative z-10 line-clamp-2">
                   {note.data.description}
                 </p>
               </div>
               <div class="mt-4 flex items-center text-xs font-semibold text-accent opacity-0 group-hover:opacity-100 transition-opacity transform -translate-x-2 group-hover:translate-x-0">
                 é˜…è¯»æ–‡æ¡£ <span class="text-lg ml-1 leading-none">â†’</span>
               </div>
            </div>
          </a>
        ))}
      </div>
    </main>

  </div>
</Layout>

<style>
  .custom-scrollbar::-webkit-scrollbar {
    width: 4px;
  }
  .custom-scrollbar::-webkit-scrollbar-track {
    background: transparent;
  }
  .custom-scrollbar::-webkit-scrollbar-thumb {
    background-color: rgba(156, 163, 175, 0.3);
    border-radius: 20px;
  }
  .dark .custom-scrollbar::-webkit-scrollbar-thumb {
    background-color: rgba(255, 255, 255, 0.1);
  }
  .custom-scrollbar:hover::-webkit-scrollbar-thumb {
    background-color: rgba(156, 163, 175, 0.5);
  }
</style>
